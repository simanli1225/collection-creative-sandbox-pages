# Native Wrapper

Easily integrate React Native components into your existing applications.

[![Build Status](https://delivery-external.squarespace.net/api/badges/sqsp/react-native-toolkit/status.svg)](https://delivery.squarespace.net/sqsp/react-native-toolkit)

React Native is a great way to make UIs, but adapting it in existing applications can be daunting. Native Wrapper is a lean set of base-classes and utilities to reduce boilerplate, get your React components integrated in your iOS app, and make it easier for your Swift/ObjC and Javascript code talking to each other.

In short, Native Wrapper provides…

- ReactViewController and ReactView, to easily wrap React Native components.
- Macros and utilities for defining native modules to call from your Javascript code.

## Component Wrappers

Native Wrapper component wrappers are native base classes which act as facades to your React Native components. With minimal code you can wrap a React Native component and start using it in your view hierarchy, with the rest of your app none the wiser.

All you need to do is…

1. Subclass `ReactViewController`.
2. override `componentName`. This is the name in your React Native `AppRegistry`.
3. override `props()`. These values will be passed to your component's constructor and when you call `updateProps()` on your wrapper instance.

Here's an example:

```swift
import SQReactNative

public final class ExampleViewController: ReactViewController {
    public init() {
        super.init()
    }

    override open var componentName: String {
        return "ExampleComponent"
    }

    override open func props() -> [String: AnyObject]  {
        return [
            "content": "Data passed in from from native code."
        ]
    }    
}
```

## Native Modules

Native Wrapper can also help make communicating between your native and javascript code easier.

Sometimes your components and wrappers need to interact. To handle javascript -> native methods, each wrapped component is initiated with a `identifier` prop in it's constructor. Pass this identifier back from javascript in your native module calls, and call `ObjectReference.object(forReference:)` to get your native wrapper instance. This allows your component to pass messages to it's wrapper, even when more than one wrapped component is on screen at a time.

In cases where your native module is forwarding all of it's messages to your wrapper view controllers, Native Wrapper provides a macro to help out. See `CallbackBridge.h` for more details and an example.

For native -> javascript, `ReactViewController` has a generic `module(for:Type)` to quickly get a refrence to your native module instance. This can be used to pass events from your wrapper to it's component if your native module extends `RCTEventEmitter`.

```swift
// in your native wrapper
func handleSomeEvent() {
  module(for: MyNativeModuleClass.self)?.emitSomeEvent()
}
```

## Adding as a dependency

Run `npm install "@sqs/react-native-toolkit"` in the same directory as your `package.json` file

### iOS

Add the folllowing to your podfile

```ruby
pod 'SQReactNative', :path => 'React/node_modules/@sqs/react-native-toolkit'
```

### Android

Add the location of `node_modules` and register the project by name in the root `settings.gradle`

```groovy
// location of node modules
def nodeModulesDir = new File("../node_modules")

// registering the project
include ':rn-toolkit'
project(':rn-toolkit').projectDir = new File(nodeModulesDir, '@sqs/react-native-toolkit/android')
```

Then add the project as a dependency to the android app `build.gradle`:

```groovy
dependencies {
  implementation project(':rn-toolkit')
}
```

## Development

This repo uses [nodenv](https://github.com/nodenv/nodenv) for Node.js version management so please make sure that you have it installed with [nodenv-aliases](https://github.com/nodenv/nodenv-aliases) plugin. You can install it by running:

```sh
brew install nodenv
brew install nodenv/nodenv/nodenv-aliases
```

After that please make sure that you have installed Node.js version from `.node-version` file. You can install it by running `nodenv install major.minor.patch`. You can see all available versions by running `nodenv install --list` or by looking at the [official Node.js page](https://nodejs.org/en/download/releases).

Be sure to run `npm ci` to install the necessary development dependencies.

This repository uses the [conventional commit](https://www.conventionalcommits.org/en/v1.0.0/) message format.
Your commit messages should follow this format. If you'd like, you can run `npm run git:commit` to be prompted
interactively for the fields necessary for your commit message.

## Publishing

The `@sqs/react-native-toolkit` package is automatically versioned and published by Drone.
When you merge a PR into `master` it will trigger versioning and publishing.
The only strict requirement is conventional commits. Please use `npm run git:commit` for assistance.
