const path = require('path');
const { requireConfig, writeJsonFileSync } = require('../utils');
const { MONOREPO_TOOLS } = require('../utils/monorepo');

/**
 * Some tooling requires an extension of the default
 * scripts, given expectations of the tooling.
 *
 * @param {Object} answers PlopJs answers object
 */
module.exports = function(answers) {
  const { directory, monorepoTool } = answers;
  const packageJsonPath = path.join(directory, 'package.json');
  const packageJson = requireConfig(packageJsonPath);

  // For Rush projects we want to clean the .rush directory
  // so we aren't left with incremental metadata that thinks
  // we have build output when we don't.
  if (monorepoTool === MONOREPO_TOOLS.RUSH) {
    packageJson.scripts = packageJson.scripts || {};

    const removeRushDirCmd = 'rm -rf .rush';
    packageJson.scripts.clean = packageJson.scripts.clean ?
      `${packageJson.scripts.clean} && ${removeRushDirCmd}` :
      removeRushDirCmd;
  }

  writeJsonFileSync(packageJsonPath, packageJson);
};