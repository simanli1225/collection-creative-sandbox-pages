const path = require('path');
const { RushConfiguration } = require('@microsoft/rush-lib');
const { requireConfig, writeJsonFileSync } = require('../utils');

/**
 * Given the provided answers, append the information to
 * the projects configured within the rush.json
 *
 * @param {Object} answers PlopJs answers object
 */
module.exports = function(answers) {
  const { directory, name } = answers;
  const { rushJsonFile: rushJsonFilePath } = RushConfiguration.loadFromDefaultLocation({
    startingFolder: process.cwd()
  });

  const rushJson = requireConfig(rushJsonFilePath);
  writeJsonFileSync(rushJsonFilePath, {
    ...rushJson,
    projects: [
      ...rushJson.projects,
      {
        packageName: name,
        projectFolder: path.relative(path.dirname(rushJsonFilePath), directory)
      }
    ]
  });
};