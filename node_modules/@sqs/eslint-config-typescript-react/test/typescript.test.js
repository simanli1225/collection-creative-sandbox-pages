const { lintFixtures } = require('@sqs/eslint-config-core/utils/testUtils');
const path = require('path');

describe('TypeScript eslintConfig', function () {
  const rootPath = path.join(__dirname, '__fixtures__');
  const newConfig = Object.assign(require('../index.js'));
  const fixtures = lintFixtures(newConfig, rootPath);
  fixtures.forEach(({ fileName, result }) => {
    test(fileName, async () => {
      const awaitedResponse = await result;
      const numOfErrors =
        awaitedResponse[0].errorCount + awaitedResponse[0].warningCount;
      const isBadFixture = fileName.indexOf('.bad.') !== -1;
      const shouldReportErrors = !isBadFixture && numOfErrors > 0;
      if (shouldReportErrors) {
        awaitedResponse.forEach(({ messages }) => {
          console.log('messages', messages);
        });
      }
      if (isBadFixture) {
        expect(numOfErrors).toBeGreaterThan(0);
        expect(awaitedResponse[0].messages).toMatchSnapshot();
      } else {
        expect(numOfErrors).toEqual(0);
      }
      expect(numOfErrors).toMatchSnapshot();
    });
  });
});
