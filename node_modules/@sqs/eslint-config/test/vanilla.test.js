const path = require('path');
const { lintFixtures } = require('@sqs/eslint-config-core/utils/testUtils');

describe('eslintConfig', function () {
  const rootPath = path.join(__dirname, '__fixtures__');
  const newConfig = Object.assign(require('../index.js'));
  const fixtures = lintFixtures(newConfig, rootPath);

  fixtures.forEach(({ fileName, result }) => {
    // eslint-disable-next-line jest/valid-title
    test(fileName, async () => {
      const awaitedResponse = await result;
      const numOfErrors =
        awaitedResponse[0].errorCount + awaitedResponse[0].warningCount;
      const shouldReportErrors =
        fileName.indexOf('bad.js') === -1 && numOfErrors > 0;
      if (shouldReportErrors) {
        awaitedResponse[0].results.forEach(({ messages }) => {
          console.log('messages', messages);
        });
      }
      if (fileName.indexOf('bad.js') !== -1) {
        // eslint-disable-next-line jest/no-conditional-expect
        expect(numOfErrors).toBeGreaterThan(0);
      }
      expect(numOfErrors).toMatchSnapshot();
    });
  });
});
