# @sqs/babel-preset-febs

This preset aims to provide a sensible set of defaults for configuring Babel for projects at Squarespace.

## What does this preset provide?

✅ React support

✅ TypeScript support

✅ Outputs both CJS and ESM

✅ Transpiles code and adds polyfills using [`@babel/preset-env`](https://babeljs.io/docs/en/babel-preset-env) for targets specified in your browserslist config

✅ ES7 Class properties

✅ Dynamic `import()`

✅ Object rest/spread

✅ Strips React prop types on production builds

✅ [@babel/plugin-transform-runtime](https://babeljs.io/docs/en/babel-plugin-transform-runtime)

✅ [babel-plugin-lodash](https://github.com/lodash/babel-plugin-lodash)

✅ [babel-plugin-add-module-exports](https://github.com/59naga/babel-plugin-add-module-exports)

## Install

```sh
npm install --save-dev @sqs/babel-preset-febs
```

## Simple Usage

Add the preset name to the `preset` property of your Babel config:

```json
{
  "presets": ["@sqs/febs"]
}
```

## Usage with options

This preset follows the [standard `[EntryTarget, EntryOptions]` API for adding options to Babel presets](https://babeljs.io/docs/en/options#plugin-preset-entries).

If you need to override the default options, add the preset to the `preset` property of your Babel config as an Array instead of a string. The first item in the Array should be the preset name and the second item in the Array should be an Object containing your options.

```json
{
  "presets": [
    [
      "@sqs/febs",
      {
        /* Options here */
      }
    ]
  ]
}
```

## Options

### `react`

`Boolean`

_Default_: `true`

You can set this to `false` if your project does not use React. Doing so can potentially speed up build times.

### `typescript`

`Boolean`

_Default_: `false`


### `modules`

`"amd" | "umd" | "systemjs" | "commonjs" | "cjs" | "auto" | false`

_Default_: `false`

Configure the [@babel/preset-env `modules` option](https://babeljs.io/docs/en/babel-preset-env#modules).

### `useBuiltIns`

`"usage" | "entry" | false`

_Default_: `"entry"`

Configure the [@babel/preset-env `useBuiltIns` option](https://babeljs.io/docs/en/babel-preset-env#usebuiltins).

### `debug`

`boolean`

_Default_: `false`

Configure the [@babel/preset-env `debug` option](https://babeljs.io/docs/en/babel-preset-env#debug).

### `addDefaultProperty`

`boolean`

_Default_: `false`

Configure the [babel-plugin-add-module-exports `addDefaultProperty` option](https://www.npmjs.com/package/babel-plugin-add-module-exports#adddefaultproperty).

## Poylfills

`core-js` and `regenerator-runtime` are used for adding polyfills so that your code works in all targets defined in your project's browserslist config.

In order to properly add polyfills to your project, add the following dependencies alongside this preset:

```sh
npm install --save core-js@3 regenerator-runtime @babel/runtime
```

Then, include these dependencies once in your project **at the top** of your entry point:

```js
import 'core-js/stable';
import 'regenerator-runtime/runtime';
```

This preset will then output transpiled code that expands references to `core-js` modules to only include polyfills based on this browserslist config.

**Note**: Setting this preset's option `useBuiltIns: "usage"` [changes this behavior](https://babeljs.io/docs/en/babel-preset-env#usebuiltins-usage).

More information on polyfilling with Babel [can be found here](https://babeljs.io/docs/en/babel-polyfill).


## Babel environment

This preset defines additional environment-specific configuration. 

**development** is the default env and has all the default config
**cjs** enables commonjs modules
**test** enables commonjs modules

You can set babel's environment by setting process.env.BABEL_ENV and/or process.env.NODE_ENV.
Babel sets env to process.env.BABEL_ENV || process.env.NODE_ENV || "development".

If you are using @sqs/febs-cli to build:

 - a library (febs.config.library=true), 
  `febs build` sets env to 'cjs' or 'esm' for each type of output

 - a webapp (default) 
 `febs build --production` sets NODE_ENV to "production".
