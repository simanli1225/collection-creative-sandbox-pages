const { lintFixtures } = require('@sqs/eslint-config-core/utils/testUtils');
const path = require('path');

describe('TypeScript eslintConfig', function () {
  const rootPath = path.join(__dirname, '__fixtures__');
  const newConfig = Object.assign(require('../index.js'));
  const fixtures = lintFixtures(newConfig, rootPath);
  fixtures.forEach(({ fileName, result }) => {
    test(fileName, async () => {
      const awaitedResponse = await result;
      const numOfErrors =
        awaitedResponse[0].errorCount + awaitedResponse[0].warningCount;
      const shouldReportErrors =
        fileName.indexOf('bad.ts') === -1 && numOfErrors > 0;
      if (shouldReportErrors) {
        awaitedResponse[0].results.forEach(({ messages }) => {
          console.log('messages', messages);
        });
      }
      if (fileName.indexOf('bad.ts') !== -1) {
        expect(numOfErrors).toBeGreaterThan(0);
        expect(awaitedResponse[0].messages).toMatchSnapshot();
      }
      expect(numOfErrors).toMatchSnapshot();
    });
  });
});
