"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.hash = void 0;
var tslib_1 = require("tslib");
var md5_1 = tslib_1.__importDefault(require("md5"));
var memoize_1 = tslib_1.__importDefault(require("lodash/memoize"));
var PLURALIZATION_KEYS = ['one', 'other', 'few', 'many', 'two', 'zero'];
function replaceNewlines(value) {
    return value.replace(/\n/g, '\\n');
}
function resolveToStringValue(value) {
    if (typeof value === 'string') {
        return replaceNewlines(value);
    }
    if (typeof value === 'object' && !Array.isArray(value)) {
        return Object.keys(value)
            .map(function (key) { return (PLURALIZATION_KEYS.includes(key) ? "".concat(key, ":").concat(value[key]) : ''); })
            .join('');
    }
    return '';
}
function getHashKey(project, value, notes) {
    var resolvedStringValue = value ? 'value:' + resolveToStringValue(value) : '';
    var resolvedNotesValue = notes ? 'notes:' + replaceNewlines(notes) : '';
    var key = notes
        ? project + resolvedStringValue + resolvedNotesValue
        : project + resolvedStringValue;
    return key;
}
function getHash(project, value, notes) {
    var hashSum = getHashKey(project, value, notes);
    return (0, md5_1.default)(hashSum);
}
exports.hash = (0, memoize_1.default)(getHash, getHashKey);
