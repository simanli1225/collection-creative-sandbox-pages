package com.squarespace.reactnative

import android.view.View
import com.facebook.react.ReactPackage
import com.facebook.react.bridge.NativeModule
import com.facebook.react.bridge.ReactApplicationContext
import com.facebook.react.uimanager.ReactShadowNode
import com.facebook.react.uimanager.ViewManager
import com.squarespace.android.commons.rx.scheduler.DefaultSchedulerProvider
import com.squarespace.android.tracker.operational.DefaultOpEventLogger
import com.squarespace.android.tracker.operational.LogcatTracker
import com.squarespace.reactnative.network.NetworkBridge
import com.squarespace.reactnative.network.client.ClientFactory

/**
 * Includes all network related [modules][NativeModule] and [view managers][ViewManager].
 *
 * Provides reasonable defaults. To customize, add use the individual modules instead.
 *
 * @param clientFactory dynamically constructs a client that can be used to make http requests.
 */
class NetworkPackage(private val clientFactory: ClientFactory) : ReactPackage {

  override fun createNativeModules(reactContext: ReactApplicationContext): List<NativeModule> =
    listOf(
      NetworkBridge(
        context = reactContext,
        clientFactory = clientFactory,
        schedulerProvider = DefaultSchedulerProvider(),
        opEventLogger = DefaultOpEventLogger(LogcatTracker())
      )
    )

  override fun createViewManagers(reactContext: ReactApplicationContext): List<ViewManager<View, ReactShadowNode<*>>> =
    emptyList()

}
