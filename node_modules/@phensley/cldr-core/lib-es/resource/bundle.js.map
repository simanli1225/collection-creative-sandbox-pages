{"version":3,"file":"bundle.js","sourceRoot":"","sources":["../../src/resource/bundle.ts"],"names":[],"mappings":"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","sourcesContent":["import { PrimitiveBundle } from '@phensley/cldr-types';\nimport { pluralRules, PluralRules } from '@phensley/plurals';\nimport { LanguageTag } from '@phensley/language-tag';\n\n/**\n * @internal\n */\nexport type ExceptionIndex = { [y: number]: number };\n\n/**\n * @public\n */\nexport interface Bundle extends PrimitiveBundle {\n  tag(): LanguageTag;\n  calendarSystem(): string;\n  numberSystem(): string;\n  languageScript(): string;\n  languageRegion(): string;\n  spellout(): any;\n  plurals(): PluralRules;\n}\n\n/**\n * @internal\n */\nexport class StringBundle implements Bundle {\n  // Properties for fast internal lookups into maps.\n  // For example, extended day periods cover all of 'es' except for 'es-CO'.\n  // Pre-computing these to avoid string creation for lookups at runtime.\n  private _languageRegion: string;\n  private _languageScript: string;\n\n  // Empty string will select the preferred calendar for the region.\n  private _calendarSystem: string = '';\n  private _numberSystem: string = 'default';\n\n  // Plural rules are used in many places, so provide them on the bundle\n  private _plurals: PluralRules;\n\n  constructor(\n    private _id: string,\n    private _tag: LanguageTag,\n    private strings: string[],\n    private exceptions: string[],\n    private index: ExceptionIndex,\n    private _spellout: any,\n  ) {\n    const language = _tag.language();\n    this._languageRegion = `${language}-${_tag.region()}`;\n    this._languageScript = `${language}-${_tag.script()}`;\n    this._plurals = pluralRules.get(language, _tag.region());\n\n    // When bundle is constructed, see if there are unicode extensions for\n    // number and calendar systems.\n    for (const subtag of _tag.extensionSubtags('u')) {\n      if (subtag.startsWith('nu-')) {\n        this._numberSystem = subtag.substring(3);\n      } else if (subtag.startsWith('ca-')) {\n        this._calendarSystem = subtag.substring(3);\n      }\n    }\n  }\n\n  id(): string {\n    return this._id;\n  }\n\n  tag(): LanguageTag {\n    return this._tag;\n  }\n\n  language(): string {\n    return this._tag.language();\n  }\n\n  region(): string {\n    return this._tag.region();\n  }\n\n  languageScript(): string {\n    return this._languageScript;\n  }\n\n  languageRegion(): string {\n    return this._languageRegion;\n  }\n\n  calendarSystem(): string {\n    return this._calendarSystem;\n  }\n\n  numberSystem(): string {\n    return this._numberSystem;\n  }\n\n  get(offset: number): string {\n    // If there is an exception index, attempt to resolve it.\n    /* istanbul ignore else */\n    if (this.index) {\n      const i = this.index[offset];\n      if (i !== undefined) {\n        return this.exceptions[i] || '';\n      }\n    }\n\n    // Return the actual string.\n    return this.strings[offset] || '';\n  }\n\n  /**\n   * Group of spellout rules inside this bundle.\n   */\n  spellout(): any {\n    return this._spellout;\n  }\n\n  /**\n   * Plural rules for cardinals and ordinals for this locale.\n   */\n  plurals(): PluralRules {\n    return this._plurals;\n  }\n}\n"]}